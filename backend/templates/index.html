<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YOLO Object Detection</title>
    <!-- Link to Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Nunito", sans-serif;
      }
      #popup {
        position: absolute;
        background-image: url("popup_background.png");
        background-color: #082857;
        background-size: cover;
        background-position: center;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        display: none;
        z-index: 1000;
        max-width: 500px;
        width: 100%;
        box-sizing: border-box;
      }
      .popup-content {
        margin-bottom: 10px;
        font-size: 25px;
        color: hsl(302, 86%, 64%);
        font-weight: 500;
      }
      .popup-text {
        margin-bottom: 10px;
        font-size: 14px;
        color: #f9eadb;
      }
      .popup-header {
        font-weight: 500;
        margin-bottom: 10px;
        font-size: 14px;
        color: #f9eadb;
      }
    </style>
  </head>
  <body>
    <h1>YOLOv8 Object Detection</h1>
    <img
      src="{{ url_for('video_feed') }}"
      id="videoFeed"
      onclick="showPopup(event)"
      style="max-width: 100%; height: auto"
    />

    <div id="popup">
      <div id="popup-content" class="popup-content">Object Info</div>
      <div id="popup-pos" class="popup-text">Noun</div>
      <div class="popup-header">Usages</div>
      <div id="popup-usages" class="popup-text">Sentences</div>
    </div>

    <script>
      function showPopup(event) {
        var popup = document.getElementById("popup");
        var content = document.getElementById("popup-content");
        var posElement = document.getElementById("popup-pos");
        var usagesElement = document.getElementById("popup-usages");

        var x = event.offsetX;
        var y = event.offsetY;

        // Send the click event to Flask backend
        fetch(`/click_event/${x}/${y}`)
          .then((response) => response.json()) // Get the JSON response
          .then((data) => {
            if (data.label !== "No object clicked") {
              // Display the object info in the popup
              content.innerHTML = data.label;
              posElement.innerHTML = data.part_of_speech || 'Unknown';
              usagesElement.innerHTML = data.usages ? data.usages.join(', ') : 'No usage info available';
              
              popup.style.left = event.pageX + "px";
              popup.style.top = event.pageY + "px";
              popup.style.display = "block";
            }
          })
          .catch((error) => console.error("Error:", error));
      }

      // Hide popup when clicking outside
      document.addEventListener("click", function (e) {
        if (!e.target.closest("#videoFeed")) {
          document.getElementById("popup").style.display = "none";
        }
      });
    </script>
  </body>
</html>
