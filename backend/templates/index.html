<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-Time Object Translation</title>
    <!-- Link to Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Nunito", sans-serif;
      }
      #popup {
        position: absolute;
        background-image: url("popup_background.png"); /* Add this line */
        background-color: #082857;
        background-size: cover; /* Ensures the background image covers the entire popup */
        background-position: center; /* Centers the background image */
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        display: none;
        z-index: 1000;
        max-width: 500px; /* Increased width */
        width: 100%; /* Ensure it takes up the full width if needed */
        box-sizing: border-box; /* Includes padding and border in element's total width and height */
      }
      .popup-content {
        margin-bottom: 10px;
        font-size: 25px;
        color: hsl(302, 86%, 64%);
        font-weight: 500;
      }
      .popup-text {
        margin-bottom: 10px;
        font-size: 14px;
        color: #f9eadb;
      }
      .popup-header {
        font-weight: 500;
        margin-bottom: 10px;
        font-size: 14px;
        color: #f9eadb;
      }
    </style>
  </head>
  <body>
    <h1>YOLOv8 Object Detection</h1>
    <img
      src="{{ url_for('video_feed') }}"
      id="videoFeed"
      onclick="showPopup(event)"
      style="max-width: 100%; height: auto"
    />

    <div id="popup">
      <div id="popup-content" class="popup-content">Object Info</div>
      <div id="pos" class="popup-text"></div>
      <div id="pronunciation" class="popup-text"></div>
      <div class="popup-header">Usages</div>
      <div id="sentences" class="popup-text"></div>
      <div id="synonyms" class="popup-text"></div>
      <div id="antonyms" class="popup-text"></div>
    </div>

    <script>
      function showPopup(event) {
        var popup = document.getElementById("popup");
        var content = document.getElementById("popup-content");
        var pos = document.getElementById("pos");
        var pronunciation = document.getElementById("pronunciation");
        var sentences = document.getElementById("sentences");
        var synonyms = document.getElementById("synonyms");
        var antonyms = document.getElementById("antonyms");

        var x = event.offsetX;
        var y = event.offsetY;

        // Send the click event to Flask backend
        fetch(`/click_event/${x}/${y}`)
          .then((response) => response.text()) // Get the response text (object label)
          .then((label) => {
            if (label !== "No object clicked") {
              content.innerHTML = label;
              // Check the label and update the popup fields accordingly
              if (label === "teddy bear") {
                content.innerHTML = "osito de peluche";
                pos.innerHTML = "Noun";
                pronunciation.innerHTML = "/oˈsi.to de peˈlu.tʃe/";
                sentences.innerHTML = "1. Abrazó con fuerza al suave osito de peluche mientras se dormía.<br>2. El niño llevaba su osito de peluche favorito a todas partes.<br>3. Compré un osito de peluche nuevo para el cumpleaños de mi sobrina";
                // synonyms.innerHTML = "Synonyms: Plush toy, Stuffed animal";
                // antonyms.innerHTML = "Antonyms: None";
              } else if (label === "bottle") {
                content.innerHTML = "botella";
                pos.innerHTML = "Noun";
                pronunciation.innerHTML = "/boˈte.ʎa/";
                sentences.innerHTML = "1. Ella llenó el biberón de vidrio con agua fresca del manantial.<br>2. Él colocó la leche del bebé en el biberón antes de alimentarla.<br>3. Accidentalmente dejé caer el biberón y se rompió en el suelo.";
                // synonyms.innerHTML = "Synonyms: Flask, Container";
                // antonyms.innerHTML = "Antonyms: None";
              } else if (label === "laptop") {
                content.innerHTML = "computadora portátil";
                pos.innerHTML = "Noun";
                pronunciation.innerHTML = "/porˈta.til/";
                sentences.innerHTML = "1. Usó su portátil para trabajar desde casa.<br>2. El portátil se calentó después de varias horas de uso.<br>3. Compré una funda para proteger mi portátil mientras viajo.";
                // synonyms.innerHTML = "Synonyms: Laptop computer, Notebook";
                // antonyms.innerHTML = "Antonyms: Desktop";
              } else {
                // Default fields for other objects
                pos.innerHTML = "Part of Speech: Unknown";
                pronunciation.innerHTML = "Pronunciation: Not available";
                sentences.innerHTML = "Sentences: Not available";
                synonyms.innerHTML = "Synonyms: Not available";
                antonyms.innerHTML = "Antonyms: Not available";
              }

              popup.style.left = event.pageX + "px";
              popup.style.top = event.pageY + "px";
              popup.style.display = "block";
            }
          })
          .catch((error) => console.error("Error:", error));
      }

      // Hide popup when clicking outside
      document.addEventListener("click", function (e) {
        if (!e.target.closest("#videoFeed")) {
          document.getElementById("popup").style.display = "none";
        }
      });
    </script>
  </body>
</html>
